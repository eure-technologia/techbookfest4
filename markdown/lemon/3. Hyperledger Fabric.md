# 3. Hyperledger Fabric
#技術書展

## 3.1 仮想通貨に依存しないブロックチェーン
ブロックチェーンの大半は仮想通貨の裏で動くインフラのような立ち位置としてあり、そこを利用してアプリケーションを開発するようなものも多いです。

それに対して、オープンソースのブロックチェーン基盤を世界的に使おうという流れがあります。
Linux Foundationが主導する、Hyperledgerプロジェクトと呼ばれるものです。

![](3.%20Hyperledger%20Fabric/Unknown.png)


Hyperledgerは分散台帳の共通規格として構想され、実際の実装されたものはいくつかあります。
1. Hyperledger Fabric(IBM)
2. Hyperledger Sawtooth(Intel)
3. Hyperledger Iroha (Soramitsu)

と様々な会社が実装したものを作っています。今回はこの中でもおそらく一番メジャーな
Hyperledger Fabricを使った環境構築と、簡単なブロックチェーンアプリケーションの実装をおこなってみましょう。

## 3.2 スマートコントラクト(チェーンコード)
HyperledgerFabricでは、スマートコントラクトを「チェーンコード」と読んでいます。
チェーンコードはGo, Typescript(Javascript)などに対応しています。

定義しなければいけない処理としては
* どういう資産をブロックチェーン上で管理するのか
* スマートコントラクト上に参加する人
* ビジネスロジック部分
* アクセス権限

といったものになります。
どういうユーザーがブロックチェーン上の情報を取れて取れないのかとか、
情報を使って何をどう判定するのかというような処理と、取引で用いる、あるいは
保存する資産（アセット）を定義してあげるようなイメージですね。

デプロイ、開発、定義、これらを比較的簡単に勧められるツールとしてHyperledger Composerがあります。

今回はそれを使ってスマートコントラクトの開発、並びにクライアントの開発を行っていきましょう。　

## 3.2.1 環境構築(Node)
Hyperledger FabricとHyperledger Composerの両方を構築し、簡単にプレイグランドで遊ぶところから始めましょう。
対象は**Mac OS**としています。

(この項では、2018/ 03 時点でのComposerとFabricのインストールガイドを参考に作成しています）
Composerの使用には、nodeが必要です。バージョンを指定できるよう、Node Version Managerをインストールしておきましょう。

```bash: command
curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.0/install.sh | bash
```

この際、Gitが初めてであればXcode Command Line Toolのインストールが求められることがあります。
Xcodeをインストールしたことがあれば入っていると思いますが、求められる場合はInstallという選択をタップして先に勧めてください

```bash: command
touch .bash_profile
```

上記のコマンドを $HOME( = Users_username_）で実行し、PATHの設定ファイルを作成します。

その後、
```bash: command 
curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.0/install.sh | bash
```

を実行してください。NVMのインストールが始まります。インストールが終了したら、ターミナルを開き直してください。

NVMはバージョン管理ツールなので、バージョンを指定してインストールできます。
Nodeの環境は、特定のバージョンでしか実行できないパッケージも多く、バージョン管理ツール経由でNodejsをインストールすることを強くお勧めします。
Nvmが入ったら、以下のコマンドを叩いてnodeをインストールしましょう。

```
nvm install --lts
```

NodeのLTSバージョン(Long Term Supportバージョン)を入れておきましょう。安定しています。
2018/03時点では、LTSは8.10.0です。

```
nvm use --lts
```

インストール後、上のコマンドを叩いてnvmに紐づくNodeを指定します。
そのあとNodeのバージョンがいくつかを調べるために
```
node --version
```
を叩いてみてください。

## 3.2.2 環境構築(Docker)
Hyperledgerの環境にはDockerが必要です。
```
[Install Docker for Mac | Docker Documentation](https://docs.docker.com/docker-for-mac/install/#download-docker-for-mac)
```

よりDockerをダウンロードしてインストールしておいてください。

## 3.2.3 環境構築(VSCode)
推奨エディタとしてVisual Studio Codeをあげていますので

```
[Visual Studio Code - Code Editing. Redefined](https://code.visualstudio.com)
```

よりインストールしてください。
加えて、Visual Studio Codeには、Hyperledger Composer用の拡張機能が提供されています。
左の拡張機能ボタンより`Hyperledger Composer Extension`で検索してインストールしておきましょう。

## 3.2.4 Hyperledger Composerの環境構築
まずはComposerのCLIを入れましょう
```
npm install -g composer-cli
```

続いて、
```
npm install -g composer-rest-server
```
ComposerのRest Serverを立てるパッケージも入れましょう
```
npm install -g generator-hyperledger-composer
```
Composerのgeneratorも入れます。このgeneratorを使用するにはyoを使います
```
npm install -g yo
```

Composerのファイルはこちらで以上です。次項でPlaygroundを扱うのでPlaygroundを落としてください
```
npm install -g composer-playground
```

## 3.2.5 Hyperledger Fabricの開発環境構築
Composerのデプロイ先であるブロックチェーン環境の構築も行います
```
mkdir ~/fabric-tools && cd ~/fabric-tools

curl -O https://raw.githubusercontent.com/hyperledger/composer-tools/master/packages/fabric-dev-servers/fabric-dev-servers.zip
unzip fabric-dev-servers.zip
```
FABRICの環境が解凍されるので、
```
cd ~/fabric-tools
./downloadFabric.sh
```
で、Hyperledger Fabricの環境のダウンロードを始めてください。

フォルダ内で次のコマンドを実行することでHyperledger Fabricの環境のセットアップが完了します。(Dockerが起動している状態で行ってください)
```bash:
 ./startFabric.sh
 ./createPeerAdminCard.sh
```